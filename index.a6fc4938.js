var e,t,r,a,i=globalThis,n={},o={},l=i.parcelRequireaca8;null==l&&((l=function(e){if(e in n)return n[e].exports;if(e in o){var t=o[e];delete o[e];var r={id:e,exports:{}};return n[e]=r,t.call(r.exports,r,r.exports),r.exports}var a=Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}).register=function(e,t){o[e]=t},i.parcelRequireaca8=l),(0,l.register)("27Lyk",function(e,t){Object.defineProperty(e.exports,"register",{get:()=>r,set:e=>r=e,enumerable:!0,configurable:!0});var r,a=new Map;r=function(e,t){for(var r=0;r<t.length-1;r+=2)a.set(t[r],{baseUrl:e,path:t[r+1]})}}),l("27Lyk").register(new URL("",import.meta.url).toString(),JSON.parse('["aT88m","index.a6fc4938.js","6xSCA","tileset.d92f4525.png","h0uMK","demon.07abaa9f.png","kolwG","hit.a1098d96.mp3","3dBfA","player.429cac3e.png","fAPus","bling.5ae92f5b.mp3","2pqM0","pickup.b7a52900.mp3"]'));const s=new Image;var c={};c=new URL("tileset.d92f4525.png",import.meta.url).toString();const d=new URL(c);s.src=d.toString();const g=document.getElementById("canvas");if(!g||!(g instanceof HTMLCanvasElement))throw Error("Missing canvas");g.width=960,g.height=704;const h=g.getContext("2d");if(!h)throw Error("Missing context");h.webkitImageSmoothingEnabled=!1,h.mozImageSmoothingEnabled=!1,h.imageSmoothingEnabled=!1,h.scale(8,8);const y=()=>({canvas:g,ctx:h}),x=()=>{h.clearRect(0,0,g.width,g.height),h.moveTo(0,0),h.fillStyle="#191B1A",h.beginPath(),h.rect(0,0,g.width,g.height),h.fill()},{ctx:p}=y(),w=new Image;var f={};f=new URL("demon.07abaa9f.png",import.meta.url).toString();const m=new URL(f);w.src=m.toString();let u=0,b=0;const R=e=>{if(!e.isActive)return;++u>=20&&(b++,u=0),b>=5&&(b=0);let t=Math.floor(b%5),r=Math.floor(b/5),a=e.x-.5*e.w,i=e.y-.5*e.h;p.drawImage(w,Math.floor(24*t),Math.round(24*r),24,24,a,i,e.w,e.h),E(e),e.debug&&(p.strokeStyle="#FFFFFF",p.lineWidth=1/8,p.beginPath(),p.rect(a,i,e.w,e.h),p.stroke(),p.beginPath(),p.moveTo(a,i),p.lineTo(a+e.w,i+e.h),p.stroke(),p.beginPath(),p.moveTo(a+e.w,i),p.lineTo(a,i+e.h),p.stroke())},E=e=>{p.beginPath(),p.fillStyle="#191b1a",p.rect(1,1,50,5),p.fill(),p.beginPath(),p.fillStyle="#294257",p.rect(1.5,1.5,49,4),p.fill(),p.beginPath(),p.fillStyle="#99c9b3",p.rect(1.5,1.5,49*e.health,4),p.fill()},S=(e,t)=>{e.isActive&&(e.vel.x=e.x<K.x?15:-15,e.vel.y=e.y<K.y?15:-15,e.x+=e.vel.x*t,e.y+=e.vel.y*t)};var v={};v=new URL("hit.a1098d96.mp3",import.meta.url).toString();const M=new Audio(new URL(v).toString());M.load();const A={x:70,y:40,vel:{x:0,y:0},w:24,h:24,health:1,debug:!1,isActive:!1,update:e=>S(A,e),draw:()=>R(A),hit:()=>{A.health-=.01,M.play(),A.health<=0&&(alert("Game over!"),A.health=1,A.isActive=!1)}},{ctx:L}=y(),I=new Image;var _={};_=new URL("player.429cac3e.png",import.meta.url).toString();const F=new URL(_);I.src=F.toString();let T=0,H=0;const O=(e,t)=>{++T>=30&&(H++,T=0),H>2&&(H=0);let r=Math.floor(H%8),a=Math.floor(H/8),i=e.x-.5*e.w,n=e.y-.5*e.h;L.drawImage(I,Math.floor(8*r),Math.round(8*a),8,8,i,n,8,8),e.debug&&(L.strokeStyle="#E00000",L.lineWidth=.25,L.fillStyle="#FFFFFF",L.beginPath(),L.rect(i,n,e.w,e.h),L.stroke())},k=(e,t)=>{e.isActive&&(L.fillStyle="#99c9b3",L.beginPath(),L.arc(e.x,e.y,e.r,0,2*Math.PI),L.fill())};(e=r||(r={}))[e.EMPTY=0]="EMPTY",e[e.MAIN=1]="MAIN",e[e.CANDLE_ROOM_1=2]="CANDLE_ROOM_1",e[e.CANDLE_ROOM_2=3]="CANDLE_ROOM_2",e[e.CANDLE_ROOM_3=4]="CANDLE_ROOM_3",e[e.CANDLE_ROOM_4=5]="CANDLE_ROOM_4",e[e.CANDLE_ROOM_5=6]="CANDLE_ROOM_5";const B=new Map([[r.MAIN,"Q#############E\nL0000000000000R\nL0000000000000R\nL0000000000000R\nL0000012300000R\nL0000045600000R\nL0000078900000R\nL0000000000000R\nL0000000000000R\nL0000000000000R\nTBBBBBBBBBBBBBY"],[r.EMPTY,"Q#############E\nL0000000000000R\nL0000000000000R\nL0000000000000R\nL0000000000000R\nL0000000000000R\nL0000000000000R\nL0000000000000R\nL0000000000000R\nL0000000000000R\nTBBBBBBBBBBBBBY"]]),{ctx:P}=y(),N=e=>{let t=e.type.graphicIndexes[e.type.currentFrame],r=8*e.x,a=8*e.y;P.drawImage(s,8*Math.floor(t%16),8*Math.floor(t/16),8,8,r,a,8,8),e.debug&&(P.strokeStyle="#FFFFFF",P.lineWidth=1/8,P.beginPath(),P.rect(r,a,8,8),P.stroke())},U=e=>{e.forEach(N)},C={isSolid:!1,isAnimated:!1,isInteractive:!1,acc:0,currentFrame:0,frameDuration:0,graphicIndexes:[0]},D=new Map,Y={air:{...C},ground:{...C,graphicIndexes:[34]},wall:{topLeft:{...C,isSolid:!0,graphicIndexes:[1]},top:{...C,isSolid:!0,graphicIndexes:[2]},topRight:{...C,isSolid:!0,graphicIndexes:[5]},left:{...C,isSolid:!0,graphicIndexes:[17]},right:{...C,isSolid:!0,graphicIndexes:[21]},bottomLeft:{...C,isSolid:!0,graphicIndexes:[65]},bottom:{...C,isSolid:!0,graphicIndexes:[66]},bottomRight:{...C,isSolid:!0,graphicIndexes:[69]}},gateway:{north:{...C,isInteractive:!0,graphicIndexes:[3]},east:{...C,isInteractive:!0,graphicIndexes:[37]},south:{...C,isInteractive:!0,graphicIndexes:[67]},west:{...C,isInteractive:!0,graphicIndexes:[33]}},candle:{...C,isAnimated:!0,isInteractive:!0,acc:0,currentFrame:0,frameDuration:30,graphicIndexes:[9,10,11,12]}};D.set(" ",Y.air),D.set("0",Y.ground),D.set("Q",Y.wall.topLeft),D.set("#",Y.wall.top),D.set("E",Y.wall.topRight),D.set("R",Y.wall.right),D.set("L",Y.wall.left),D.set("T",Y.wall.bottomLeft),D.set("B",Y.wall.bottom),D.set("Y",Y.wall.bottomRight),D.set("H",Y.gateway.north),D.set("J",Y.gateway.east),D.set("N",Y.gateway.south),D.set("M",Y.gateway.west),D.set("C",Y.candle),D.set("1",{...C,graphicIndexes:[80]}),D.set("2",{...C,graphicIndexes:[81]}),D.set("3",{...C,graphicIndexes:[82]}),D.set("4",{...C,graphicIndexes:[96]}),D.set("5",{...C,graphicIndexes:[97]}),D.set("6",{...C,graphicIndexes:[98]}),D.set("7",{...C,graphicIndexes:[112]}),D.set("8",{...C,graphicIndexes:[113]}),D.set("9",{...C,graphicIndexes:[114]}),(t=a||(a={}))[t.NORTH=0]="NORTH",t[t.EAST=1]="EAST",t[t.SOUTH=2]="SOUTH",t[t.WEST=3]="WEST";const W=(e,t)=>{let r=e.split("\n").map(e=>e.split("")),a=[];for(let e=0;e<r.length;e++){let t=r[e];for(let r=0;r<t.length;r++){let i=t[r],n={x:r,y:e,debug:!1,type:D.get(i)||Y.air};a.push(n)}}return t.forEach(e=>{let t=a.find(t=>t.x===e.x&&t.y===e.y);if(t)switch(t.debug=!0,t.gateway=e.id,e.dir){case 0:t.target={x:t.x,y:9},t.type=Y.gateway.north;break;case 1:t.target={x:1,y:t.y},t.type=Y.gateway.east;break;case 2:t.target={x:t.x,y:1},t.type=Y.gateway.south;break;case 3:t.target={x:13,y:t.y},t.type=Y.gateway.west}}),a},q=new Map([["#",r.EMPTY],["A",r.MAIN],["1",r.EMPTY],["2",r.EMPTY],["3",r.EMPTY],["4",r.EMPTY],["5",r.EMPTY]]),$=[["1"," "," "," "," "," ","4"," "],["#","#","#","#","#","#","#","#"],[" ","#"," ","#"," "," "," "," "],[" ","#","#","A","#","#","#"," "],[" ","#"," ","#"," "," ","#","3"],[" ","#","#","#"," ","#","#"," "],["2","#"," ","#","5"," "," "," "]];$.length,$[0].length;const Q=new Map;for(let e=0;e<$.length;e++){let t=$[e];for(let a=0;a<t.length;a++){let i=t[a];if(!i||" "===i)continue;let n=`room-${a}-${e}`,o=q.get(i)||r.EMPTY;Q.set(n,{x:a,y:e,id:n,type:o})}}const j=new Map;Q.forEach(e=>{let t=[{x:e.x,y:e.y-1,dir:a.NORTH},{x:e.x+1,y:e.y,dir:a.EAST},{x:e.x,y:e.y+1,dir:a.SOUTH},{x:e.x-1,y:e.y,dir:a.WEST}].reduce((e,t)=>{let r=Q.get(`room-${t.x}-${t.y}`)?.id,i=0,n=0;switch(t.dir){case a.NORTH:i=Math.floor(7.5);break;case a.EAST:i=14,n=Math.floor(5.5);break;case a.SOUTH:i=Math.floor(7.5),n=10;break;case a.WEST:n=Math.floor(5.5)}return r?[...e,{x:i,y:n,id:r,dir:t.dir}]:e},[]),r=B.get(e.type);if(!r)return;let i={id:e.id,tiles:W(r,t),draw:()=>U(i.tiles)};j.set(e.id,{...e,room:i})});const G={current:j.get("room-3-3")?.room},J=(e,t)=>{let r=G.current.tiles.find(t=>!!t.gateway&&t.x===e.tile.x&&t.y===e.tile.y);r?.gateway&&(G.current=j.get(r.gateway)?.room,e.x=8*(r.target?.x||0),e.y=8*(r.target?.y||0));let a=e.x+e.vel.x*t,i=e.y+e.vel.y*t;for(let t of G.current.tiles.filter(e=>e.type.isSolid)||[]){let r=8*t.x,n=8*t.y;a>r&&a<r+8&&i>n&&i<n+8&&(a=e.x,i=e.y)}e.x=a,e.y=i,e.tile.x=Math.floor(e.x/8),e.tile.y=Math.floor(e.y/8),e.candle&&(e.candle.x=e.x,e.candle.y=e.y,e.candle.room=G.current.id)},z=(e,t)=>{e.x+=e.vel.x*t,e.y+=e.vel.y*t;let r=A.x-e.x,a=A.y-e.y;e.isActive&&Math.sqrt(r*r+a*a)<A.w/2&&(A.hit(),e.isActive=!1)},K={x:20,y:30,w:8,h:8,vel:{x:0,y:0},tile:{x:0,y:0},debug:!1,update:e=>{J(K,e),z(V,e)},draw:e=>{O(K,e),k(V,e)},fire:()=>ee()},V={r:1,x:K.x,y:K.y,vel:{x:0,y:0},isActive:!1};var X={};X=new URL("bling.5ae92f5b.mp3",import.meta.url).toString();const Z=new Audio(new URL(X).toString());Z.load();const ee=()=>{if(V.isActive||!A.isActive)return;Z.pause(),Z.load(),Z.play(),V.x=K.x,V.y=K.y;let e=A.x-K.x,t=A.y-K.y,r=Math.sqrt(e*e+t*t);V.vel.x=e/r*100,V.vel.y=t/r*100,V.isActive=!0},{ctx:et}=y(),er=Y.candle,ea=e=>{let t=er.graphicIndexes[er.currentFrame],r=e.x-4,a=e.y-4;et.drawImage(s,8*Math.floor(t%16),8*Math.floor(t/16),8,8,r,a,8,8),e.debug&&(et.strokeStyle="#FFFFFF",et.lineWidth=1/8,et.beginPath(),et.rect(r,a,8,8),et.stroke())},ei=e=>{},en={x:16,y:8,debug:!1,room:"room-0-0",update:()=>ei(en),draw:()=>ea(en)},eo={x:64,y:64,debug:!1,room:"room-0-6",update:()=>ei(eo),draw:()=>ea(eo)},el={x:96,y:64,debug:!1,room:"room-7-4",update:()=>ei(el),draw:()=>ea(el)},es={x:80,y:16,debug:!1,room:"room-6-0",update:()=>ei(es),draw:()=>ea(es)},ec={x:64,y:32,debug:!1,room:"room-4-6",update:()=>ei(ec),draw:()=>ea(ec)},ed=[en,eo,el,es,ec];window.addEventListener("keydown",e=>{switch(e.key){case"w":K.vel.y=-50;break;case"a":K.vel.x=-50;break;case"s":K.vel.y=50;break;case"d":K.vel.x=50}}),window.addEventListener("keyup",e=>{switch(e.key){case"w":case"s":K.vel.y=0;break;case"a":case"d":K.vel.x=0;break;case"e":ey()}}),window.addEventListener("mousedown",e=>{K.fire()});var eg={};eg=new URL("pickup.b7a52900.mp3",import.meta.url).toString();const eh=new Audio(new URL(eg).toString());eh.load();const ey=()=>{if(K.candle){delete K.candle,eh.play();return}let e=ed.filter(e=>e.room===G.current.id);if(!(e.length<1)){for(let t of e)if(8>=Math.abs(K.x-t.x)&&8>=Math.abs(K.y-t.y)){K.candle=t,eh.play();break}}},ex=()=>{G.current.tiles.forEach(e=>{let t=e.x===K.tile.x&&e.y===K.tile.y;e.debug=t&&K.debug}),D.forEach(e=>{e.isAnimated&&(e.acc++,e.acc>=e.frameDuration&&(e.acc=0,e.currentFrame++),e.currentFrame>=e.graphicIndexes.length&&(e.currentFrame=0))})},{ctx:ep}=y(),ew=e=>{ex(),K.update(e),A.update(e),ed.forEach(e=>e.update()),eE()},ef=e=>{x(),G.current.draw(),K.draw(e),ed.forEach(e=>G.current.id===e.room&&e.draw()),A.draw()};let em=performance.now();const eu=()=>{let e=performance.now(),t=(e-em)/1e3;em=e,ew(t),ef(t),window.requestAnimationFrame(eu)};window.requestAnimationFrame(eu);const eb={x:48,y:32},eR=new Audio(new URL(v).toString());eR.load();const eE=()=>{if(!A.isActive&&!K.candle&&!ed.some(e=>"room-3-3"!==e.room)){for(let e of ed)if(e.x<eb.x||e.x>eb.x+24||e.y<eb.y||e.y>eb.y+24)return;A.isActive=!0,eR.play()}};
//# sourceMappingURL=index.a6fc4938.js.map
